package riws.fb;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import riws.fb.model.UserInfo;

public class DataExtractor {

	public static List<UserInfo> extract(String folderPath) throws IOException {
		List<UserInfo> listData = new ArrayList<UserInfo>();
		File folder = new File(folderPath);
		if (folder.isDirectory()) {
			for (File f : folder.listFiles()) {
				System.out.println("Extracting data of file " + f.getName());
				BufferedReader br = new BufferedReader(new FileReader(f));
				String text = br.readLine();
				while (text != null) {
					String aux = br.readLine();
					if (aux != null) {
						text += "\n" + aux;
					} else {
						break;
					}
				}
				System.out.println(text);
				UserInfo info = parseUserData(text);
				listData.add(info);
				br.close();
				break;
			}
		}
		return listData;
	}

	private static UserInfo parseUserData(String info) {
		String[] lines = info.split("\n");
		String name, studied, studiedAt, bornOn, livesIn, worksAt, from, marriedTo, relationWith, followedBy, wentTo, goesTo;
		name = studied = studiedAt = bornOn = livesIn = worksAt = from = marriedTo = relationWith = followedBy = wentTo = goesTo = null;
		int friendsTotal = 0;
		String[] friendList = null;
		for (String line : lines) {
			int index = line.indexOf(':') + 1;
			name = line.startsWith("Name:") ? line.substring(index).trim() : name;
			studied = line.startsWith("Studied:") ? line.substring(index).trim() : studied;
			studiedAt = line.startsWith("Studied at:") ? line.substring(index).trim() : studiedAt;
			friendsTotal = line.startsWith("Friends:") ? Integer.parseInt(line.substring(index).trim()) : friendsTotal;
			bornOn = line.startsWith("Born on:") ? line.substring(index).trim() : bornOn;
			livesIn = line.startsWith("Lives in:") ? line.substring(index).trim() : livesIn;
			worksAt = line.startsWith("Works at:") ? line.substring(index).trim() : worksAt;
			from = line.startsWith("From:") ? line.substring(index).trim() : from;
			marriedTo = line.startsWith("Married to:") ? line.substring(index).trim() : marriedTo;
			relationWith = line.startsWith("In a relationship with:") ? line.substring(index).trim() : relationWith;
			followedBy = line.startsWith("Followed By:") ? line.substring(index).trim() : followedBy;
			wentTo = line.startsWith("Went to:") ? line.substring(index).trim() : wentTo;
			goesTo = line.startsWith("Goes to:") ? line.substring(index).trim() : goesTo;
			friendList = line.startsWith("Friends list:") ? line.substring(line.indexOf('['), line.length() - 1).split(",") : friendList;
		}
		return new UserInfo(name, studied, studiedAt, friendsTotal, bornOn, livesIn, worksAt, from, marriedTo, relationWith, followedBy, wentTo,
				goesTo, friendList);
	}

}
